<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}Shortify{% endblock %}</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Flowbite -->
  <link href="https://unpkg.com/flowbite@1.7.0/dist/flowbite.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/flowbite@1.7.0/dist/flowbite.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', path='css/base.css') }}" />
  <link rel="icon" href="{{ url_for('static', path='img/icon.png') }}" type="image/png" sizes="32x32">
</head>

<body class="text-gray-800 bg-gray-50 flex flex-col min-h-screen">

  <!-- NAVBAR -->
  <nav class="bg-white border-b border-gray-100 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">

        <!-- LEFT: Hamburger (mobile) + Logo -->
        <div class="flex items-center gap-3">
          <!-- Hamburger for mobile (visible only on small screens) -->
          <!-- Put hamburger first so it doesn't push logo — it's inline with logo -->
          <button id="menu-toggle"
            class="md:hidden p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-300"
            aria-expanded="false" aria-controls="mobile-menu">
            <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
          </button>

          <!-- Brand -->
          <a href="/" class="flex items-center gap-2">
            <img src="{{ url_for('static', path='img/icon.png') }}" alt="Shortify Logo" class="h-15 w-20">
            <span class="text-xl font-bold text-blue-600">Shortify</span>
          </a>
        </div>

        <!-- CENTER: Desktop links (hidden on mobile) -->
        <div class="hidden md:flex md:items-center md:space-x-6">
          <a href="/" class="text-gray-700 hover:text-blue-600 transition">Home</a>
          <a href="/pricing" class="text-gray-700 hover:text-blue-600 transition">Pricing</a>
          <a href="/about" class="text-gray-700 hover:text-blue-600 transition">About</a>
        </div>

        <!-- RIGHT: Auth actions / Avatar -->
        <div class="flex items-center gap-3">
          {% if user %}
          <!-- Avatar: visible on all sizes, hamburger hidden above when logged in (we'll hide mobile hamburger via CSS if needed) -->
          <div class="relative">
            <button id="avatar-btn"
              class="flex items-center justify-center w-10 h-10 rounded-full overflow-hidden border border-gray-200 focus:outline-none">
              <img src="{{ user.avatar_url }}" alt="Avatar" class="w-full h-full object-cover">
            </button>

            <!-- avatar dropdown -->
            <div id="avatar-dropdown"
              class="hidden absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-xl shadow-lg py-1">
              <div class="px-4 py-2 text-sm text-gray-700">{{ user.email }}</div>
              <form action="/auth/logout" method="post" class="mt-1">
                <button type="submit"
                  class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-b-xl">Logout</button>
              </form>
            </div>
          </div>

          {% else %}
          <!-- Desktop auth buttons -->
          <div class="hidden md:flex items-center gap-3">
            <a href="/auth" class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:opacity-95 transition">Login</a>
            <!-- <a href="/signup"
              class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:opacity-95 transition">Sign
              up</a> -->
          </div>
          {% endif %}
        </div>
      </div>

      <!-- MOBILE MENU (stacked) -->
      <!-- Always in the DOM; toggled hidden/visible by JS. It appears as a full-width stacked list under the top bar. -->
      <div id="mobile-menu" class="hidden md:hidden border-t border-gray-100 mt-2">
        <div class="px-4 py-3 flex flex-col gap-2">
          <a href="/" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Home</a>
          <a href="/pricing"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">Pricing</a>
          <a href="/about"
            class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50">About</a>

          {% if not user %}
          <a href="/auth"
            class="block px-3 py-2 rounded-md text-base font-medium bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-center hover:opacity-95">Login</a>
          <!-- <a href="/signup"
            class="block px-3 py-2 rounded-md text-base font-medium bg-gradient-to-r from-blue-500 to-indigo-500 text-white text-center hover:opacity-95">Sign
            up</a> -->
          {% endif %}
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="flex-grow">
    {% block content %}{% endblock %}
  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-900 text-gray-200 py-6 mt-8">
    <div class="container mx-auto text-center text-sm px-4">
      Built with ❤️ by Sameer | Powered by FastAPI + Upstash Redis
    </div>
  </footer>
  <script>
    (function () {
      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const avatarBtn = document.getElementById('avatar-btn');
      const avatarDropdown = document.getElementById('avatar-dropdown');

      // mobile menu toggle (stacked list)
      if (menuToggle && mobileMenu) {
        menuToggle.addEventListener('click', function (e) {
          e.stopPropagation();
          mobileMenu.classList.toggle('hidden');
          const expanded = this.getAttribute('aria-expanded') === 'true';
          this.setAttribute('aria-expanded', String(!expanded));
        });

        // hide when clicking outside
        window.addEventListener('click', function (e) {
          if (!mobileMenu.contains(e.target) && !menuToggle.contains(e.target)) {
            mobileMenu.classList.add('hidden');
            menuToggle.setAttribute('aria-expanded', 'false');
          }
        });
      }

      // avatar dropdown toggle
      if (avatarBtn && avatarDropdown) {
        avatarBtn.addEventListener('click', function (e) {
          e.stopPropagation();
          avatarDropdown.classList.toggle('hidden');
        });
        window.addEventListener('click', function (e) {
          if (!avatarBtn.contains(e.target) && !avatarDropdown.contains(e.target)) {
            avatarDropdown.classList.add('hidden');
          }
        });
      }
    })();
  </script>
  <script src="{{ url_for('static', path='js/index.js') }}"></script>
</body>

</html>